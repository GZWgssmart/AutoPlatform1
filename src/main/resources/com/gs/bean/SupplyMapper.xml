<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gs.dao.SupplyDAO" >
  <resultMap id="supplyMap" type="com.gs.bean.Supply" >
    <id column="supplyId" property="supplyId" jdbcType="VARCHAR" />
    <result column="supplyName" property="supplyName" jdbcType="VARCHAR" />
    <result column="supplyTel" property="supplyTel" jdbcType="VARCHAR" />
    <result column="supplyPricipal" property="supplyPricipal" jdbcType="VARCHAR" />
    <result column="supplyAddress" property="supplyAddress" jdbcType="VARCHAR" />
    <result column="supplyBank" property="supplyBank" jdbcType="VARCHAR" />
    <result column="supplyBankAccount" property="supplyBankAccount" jdbcType="VARCHAR" />
    <result column="supplyBankNo" property="supplyBankNo" jdbcType="VARCHAR" />
    <result column="supplyAlipay" property="supplyAlipay" jdbcType="VARCHAR" />
    <result column="supplyWeChat" property="supplyWeChat" jdbcType="VARCHAR" />
    <result column="supplyCreatedTime" property="supplyCreatedTime" jdbcType="TIMESTAMP" />
    <result column="supplyTypeId" property="supplyTypeId" jdbcType="VARCHAR" />
    <result column="companyId" property="companyId" jdbcType="VARCHAR" />
    <result column="supplyStatus" property="supplyStatus" jdbcType="VARCHAR" />

    <association property="supplyType" javaType="com.gs.bean.SupplyType">
      <id property="supplyTypeId" column="supplyTypeId"/>
      <id property="supplyTypeName" column="supplyTypeName"/>
    </association>

    <association property="company" javaType="com.gs.bean.Company">
      <id property="companyId" column="companyId"/>
      <id property="companyName" column="companyName"/>
    </association>

  </resultMap>

  <select id="queryAll" resultMap="supplyMap">
    <![CDATA[
      select *FROM auto_platform.t_supply
    ]]>
  </select>

  <select id="queryByPager" resultMap="supplyMap" parameterType="com.gs.common.bean.Pager">
    <![CDATA[
        select s.*, st.supplyTypeId, st.supplyTypeName, co.companyId, co.companyName from t_supply s
        LEFT JOIN t_supply_type st on s.supplyTypeId = st.supplyTypeId
        LEFT JOIN t_company co on s.companyId = co.companyId
        where s.supplyStatus = 'Y' order by s.supplyCreatedTime Desc
    ]]>
    limit #{beginIndex}, #{pageSize}
  </select>

  <select id="queryByPagerDisable" resultMap="supplyMap" parameterType="com.gs.common.bean.Pager">
    <![CDATA[
       select s.*, st.supplyTypeId, st.supplyTypeName, co.companyId, co.companyName  from t_supply s
        LEFT JOIN t_supply_type st on s.supplyTypeId = st.supplyTypeId
        LEFT JOIN t_company co on s.companyId = co.companyId
        where s.supplyStatus = 'N' order by s.supplyCreatedTime Desc
    ]]>
    limit #{beginIndex}, #{pageSize}
  </select>

  <select id="count" resultType="int" >
    <![CDATA[
      select count(supplyId) from t_supply s where s.supplyStatus = 'Y'
    ]]>
  </select>
 
  <select id="countByDisable" resultType="int" >
    <![CDATA[
      select count(supplyId) from t_supply s where s.supplyStatus = 'N'
    ]]>
  </select>

  <!--
      添加供应商信息,默认添加状态为可用状态
  -->
  <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="Supply">
    <![CDATA[
        insert into auto_platform.t_supply(supplyId, supplyName, supplyTel, supplyPricipal, supplyAddress,
          supplyWeChat,supplyCreatedTime,supplyTypeId,companyId,supplyAlipay,supplyBank,supplyBankAccount,supplyBankNo,supplyStatus)
        values(uuid(),#{supplyName},#{supplyTel},#{supplyPricipal},#{supplyAddress},#{supplyWeChat},now(),#{supplyTypeId},
        #{companyId},#{supplyAlipay},#{supplyBank},#{supplyBankAccount},#{supplyBankNo},'Y')
        ]]>
  </insert>

  <!--
      根据id更新供应商信息
  -->
  <update id="update" keyProperty="id" parameterType="java.util.Map">
    UPDATE auto_platform.t_supply SET supplyName=#{supplyName},supplyTel=#{supplyTel},supplyPricipal=#{supplyPricipal},
    supplyAddress=#{supplyAddress},supplyWeChat=#{supplyWeChat},supplyCreatedTime=now(),supplyTypeId=#{supplyTypeId},companyId=#{companyId},
    supplyAlipay=#{supplyAlipay},supplyBank=#{supplyBank},supplyBankAccount=#{supplyBankAccount},supplyBankNo=#{supplyBankNo}WHERE supplyId=#{supplyId}
  </update>

  <!--
      冻结供应商信息
  -->
  <update id="inactive" keyProperty="id" parameterType="string">
    <![CDATA[
        update auto_platform.t_supply set supplyStatus = 'N' where supplyId = #{supplyId}
        ]]>
  </update>

  <!--
      激活供应商信息
  -->
  <update id="active" keyProperty="id" parameterType="string">
    <![CDATA[
        update auto_platform.t_supply set supplyStatus = 'Y' where supplyId = #{supplyId}
        ]]>
  </update>

  <!-- 分页模糊查询 -->
  <select id="blurredQuery" resultMap="supplyMap" >
    <![CDATA[
        select s.*, st.supplyTypeId, st.supplyTypeName, co.companyId, co.companyName  from t_supply s
        LEFT JOIN t_supply_type st on s.supplyTypeId = st.supplyTypeId
        LEFT JOIN t_company co on s.companyId = co.companyId
        where 1=1 and
      ]]>
    <if test="checkin.userName != '' and checkin.userName != null">
      ck.userName like '%${checkin.userName}%'
    </if>
    <if test="checkin.userName != '' and checkin.userName != null and
            checkin.companyId != '' and checkin.companyId != null">
      or
    </if>
    <if test="checkin.companyId != '' and checkin.companyId != null">
      company.companyName like '%${checkin.companyId}%'
    </if>
    <if test="checkin.companyId != '' and checkin.companyId != null and
            checkin.carPlate != '' and checkin.carPlate != null">
      or
    </if>
    <if test="checkin.carPlate != '' and checkin.carPlate != null">
      ck.carPlate like '%${checkin.carPlate}%'
    </if>
    <if test="checkin.carPlate != '' and checkin.carPlate != null and
            checkin.userPhone != '' and checkin.userPhone != null">
      or
    </if>
    <if test="checkin.userPhone != '' and checkin.userPhone != null">
      ck.userPhone like '%${checkin.userPhone}%'
    </if>
    order by ck.checkinCreatedTime Desc
    limit #{pager.beginIndex}, #{pager.pageSize}
  </select>

  <!-- 分页模糊查询个数 -->
  <select id="countByBlurred" resultType="int" >
    <![CDATA[
      select count(checkinId) from t_checkin ck
      LEFT JOIN t_user u on u.userId =ck.userId
      LEFT JOIN t_car_color cc on ck.colorId =cc.colorId
      LEFT JOIN t_car_model cm on ck.modelId = cm.modelId
      LEFT JOIN t_car_plate cp on ck.plateId = cp.plateId
      LEFT JOIN t_company company on ck.companyId = company.companyId
      LEFT JOIN t_car_brand cb on ck.brandId = cb.brandId
      where 1=1 and
    ]]>
    <if test="checkin.userName != '' and checkin.userName != null">
      ck.userName like '%${checkin.userName}%'
    </if>
    <if test="checkin.userName != '' and checkin.userName != null and
    checkin.companyId != '' and checkin.companyId != null">
      or
    </if>
    <if test="checkin.companyId != '' and checkin.companyId != null">
      company.companyName like '%${checkin.companyId}%'
    </if>
    <if test="checkin.companyId != '' and checkin.companyId != null and
    checkin.carPlate != '' and checkin.carPlate != null">
      or
    </if>
    <if test="checkin.carPlate != '' and checkin.carPlate != null">
      ck.carPlate like '%${checkin.carPlate}%'
    </if>
    <if test="checkin.carPlate != '' and checkin.carPlate != null and
    checkin.userPhone != '' and checkin.userPhone != null">
      or
    </if>
    <if test="checkin.userPhone != '' and checkin.userPhone != null">
      ck.userPhone like '%${checkin.userPhone}%'
    </if>
  </select>

</mapper>