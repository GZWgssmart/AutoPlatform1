<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gs.dao.AppointmentDAO" >
  <resultMap id="appointmentMap" type="Appointment" >
    <id column="appointmentId" property="appointmentId" jdbcType="VARCHAR" />
    <result column="userId" property="userId" jdbcType="VARCHAR" />
    <result column="userName" property="userName" jdbcType="VARCHAR" />
    <result column="userPhone" property="userPhone" jdbcType="VARCHAR" />
    <result column="brandId" property="brandId" jdbcType="VARCHAR" />
    <result column="colorId" property="colorId" jdbcType="VARCHAR" />
    <result column="modelId" property="modelId" jdbcType="VARCHAR" />
    <result column="plateId" property="plateId" jdbcType="VARCHAR" />
    <result column="carPlate" property="carPlate" jdbcType="VARCHAR" />
    <result column="arriveTime" property="arriveTime" jdbcType="TIMESTAMP" />
    <result column="maintainOrFix" property="maintainOrFix" jdbcType="VARCHAR" />
    <result column="appCreatedTime" property="appCreatedTime" jdbcType="TIMESTAMP" />
    <result column="companyId" property="companyId" jdbcType="VARCHAR" />
    <result column="appoitmentStatus" property="appoitmentStatus" jdbcType="VARCHAR" />


    <association property="brand" javaType="com.gs.bean.CarBrand">
      <id property="brandId" column="brandId"/>
      <id property="brandName" column="brandName"/>
    </association>

    <association property="color" javaType="com.gs.bean.CarColor">
      <id property="colorId" column="colorId"/>
      <id property="colorName" column="colorName"/>
    </association>

    <association property="plate" javaType="com.gs.bean.CarPlate">
      <id property="plateId" column="plateId"/>
      <id property="plateName" column="plateName"/>
    </association>

    <association property="model" javaType="com.gs.bean.CarModel">
      <id property="modelId" column="modelId"/>
      <id property="modelName" column="modelName"/>
    </association>

    <association property="company" javaType="com.gs.bean.Company">
      <id property="companyId" column="companyId"/>
      <id property="companyName" column="companyName"/>
    </association>

  </resultMap>

  <select id="queryByPager" resultMap="appointmentMap">
    <![CDATA[
       select am.*, cc.colorId, cc.colorName, cp.plateId, cp.plateName,
        cm.modelId, cm.modelName, company.companyId,
        company.companyName, cb.brandId, cb.brandName from t_appointment am
       LEFT JOIN t_car_color cc on am.colorId =cc.colorId
       LEFT JOIN t_car_model cm on am.modelId = cm.modelId
       LEFT JOIN t_car_plate cp on am.plateId = cp.plateId
       LEFT JOIN t_company company on am.companyId = company.companyId
       LEFT JOIN t_car_brand cb on am.brandId = cb.brandId
       where am.appoitmentStatus = 'Y' order by am.appCreatedTime Desc
    ]]>
    limit #{beginIndex}, #{pageSize}
  </select>

  <select id="count" resultType="int" >
    <![CDATA[
      select count(appointmentId) from t_appointment am where am.appoitmentStatus = 'Y'
    ]]>
  </select>

  <insert id="insert" parameterType="Appointment">
    <![CDATA[
    insert into auto_platform.t_appointment(appointmentId,userId,userName,userPhone,brandId,colorId,modelId,
    plateId,carPlate,arriveTime,maintainOrFix,appCreatedTime,companyId,appoitmentStatus)
    values(uuid(),#{userId},#{userName},#{userPhone},#{brandId},#{colorId},#{modelId},#{plateId},#{carPlate},#{arriveTime},
    #{maintainOrFix},CURRENT_TIMESTAMP,#{companyId},'Y');
    ]]>
  </insert>

  <insert id="update" parameterType="Appointment">
    <![CDATA[
        UPDATE auto_platform.t_appointment SET userId = #{userId}, userName = #{userName}, userPhone = #{userPhone},
        brandId = #{brandId}, colorId = #{colorId}, modelId = #{modelId}, plateId = #{plateId}, carPlate = #{carPlate},
        arriveTime = #{arriveTime}, maintainOrFix = #{maintainOrFix}, appCreatedTime = #{appCreatedTime},
         companyId = #{companyId}, appoitmentStatus = #{appoitmentStatus}
         WHERE userId = #{userId}
    ]]>
  </insert>
  
</mapper>