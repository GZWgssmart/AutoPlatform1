<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gs.dao.WorkInfoDAO" >
  <resultMap id="BaseResultMap" type="com.gs.bean.WorkInfo" >
    <id column="workId" property="workId" jdbcType="VARCHAR" />
    <!--<result column="recordId" property="recordId" jdbcType="VARCHAR" />
    <result column="userId" property="userId" jdbcType="VARCHAR" />-->
    <result column="workAssignTime" property="workAssignTime" jdbcType="TIMESTAMP" />
    <result column="workCreatedTime" property="workCreatedTime" jdbcType="TIMESTAMP" />
    <result column="workStatus" property="workStatus" jdbcType="VARCHAR" />

    <association property="maintainRecord" javaType="com.gs.bean.MaintainRecord">
        <id column="recordId" property="recordId"></id>
        <id column="checkinId" property="checkinId"/>
    </association>

    <association property="user" javaType="com.gs.bean.User">
        <id column="userId" property="userId"/>
        <id column="userNickName" property="userNickName"/>
    </association>
  </resultMap>

    <select id="count" resultType="int">
        <![CDATA[
          SELECT  count(workId) FROM t_work_info w WHERE w.workStatus='Y'
        ]]>
    </select>
    <!--分页查询全部-->
    <select id="queryByPager" resultMap="BaseResultMap" parameterType="com.gs.common.bean.Pager">
        <![CDATA[
            select w.*,tmR.recordId, tmR.chekinId,
            u.userId, u.userNickName FROM t_work_info w
            Left JOIN t_maintainRecord tmR on w.recordId = tmR.recordId
            Left JOIN t_user u on w.userId = u.userId
            ORDER BY w.workCreatedTime DESC
        ]]>
        limit #{beginIndex}, #{pageSize}
    </select>


    <!--SELECT t_work_info.*,t_maintain_record.recordId,t_user.userId FROM t_work_info-->
    <!--LEFT JOIN t_maintain_record on t_work_info.workId=t_maintain_record.recordId-->
    <!--LEFT JOIN t_user on t_work_info.userId=t_user.userId-->
    <!--ORDER BY t_work_info.workCreatedTime;-->
   <!-- 查询全部-->
  <select id="queryAll" resultMap="BaseResultMap">
      <![CDATA[
        SELECT * FROM t_work_info
         ]]>
  </select>

    <!--添加数据-->
  <insert id="insert" parameterType="com.gs.bean.WorkInfo">
      INSERT INTO activiti_proj.t_work_info
      (workId,recordId, userId, workAssignTime, workCreatedTime,workStatus)
      VALUES
      (uuid(),#{recordId},#{userId},#{workAssignTime},#{workCreatedTime},'Y')
  </insert>

    <!--删除数据-->
   <!-- <delete id="deleteById">
        DELETE FROM activiti_proj.t_work_info WHERE workId=#{workId}
    </delete>-->

    <!--更新数据-->
    <update id="update" keyProperty="workId" parameterType="com.gs.bean.WorkInfo">
        <![CDATA[
          UPDATE activiti_proj.t_work_info SET recordId=#{recordId}, userId=#{userId}, workAssignTime=#{workAssignTime}, workCreatedTime=#{workCreatedTime} WHERE workId=#{workId}
        ]]>
    </update>

    <!--冻结工单-->
    <update id="inactive" keyProperty="workId" parameterType="string">
        <![CDATA[
          UPDATE activiti_proj.t_work_info set workStatus='N' WHERE workId = #{workId}
           ]]>
    </update>

    <!--激活工单-->
    <update id="active" keyProperty="workId" parameterType="string">
      <![CDATA[
        UPDATE activiti_proj.t_work_info set workStatus='Y' WHERE workId = #{workId}
         ]]>
    </update>
</mapper>
